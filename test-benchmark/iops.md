

# IOPS和数据吞吐量

IOPS即Input/Output Operations per Second，每秒钟处理的I/O次数。

**IOPS是衡量在随机读写频繁的应用（大量小文件的读写如图片、数据库、邮件服务器等）场景下的重要衡量指标。**

> IOPS的数值会随系统配置而有很大的不同，依测试者在测试时的控制变因而异，控制变因包括读取及写入的比例、其中[循序访问](https://zh.wikipedia.org/wiki/循序存取)及[随机存取](https://zh.wikipedia.org/wiki/隨機存取)的比例及配置方式、[线程](https://zh.wikipedia.org/wiki/线程)数量及访问队列深度，以及资料区块的大小。其他因素也会影响IOPS的结果，例如系统设置、存储设备的[驱动程序](https://zh.wikipedia.org/wiki/驅動程式)、操作系统后台运行的作业等。若在测试[固态硬盘](https://zh.wikipedia.org/wiki/固态硬盘)时，是否先进行预调（preconditioning）机制也会影响IOPS的结果.

顺序读写频繁的应用（传输大量连续数据--如视频编辑）场景，主要关注连续读写性能，其重要衡量指标是数据吞吐量，即单位时间内（一般是每秒）的I/O流量。

# IOPS计算

机械硬盘一次IO操作流程如下：

1. IO指令发起

   即控制器对磁盘发出一个IO操作指令

2. 机械臂寻址  --  磁头移动到目标磁道正上方

   磁盘的驱动臂(Actuator Arm)带读写磁头(Head)离开着陆区(Landing Zone，位于内圈没有数据的区域)，移动到要操作的初始数据块所在的磁道(Track)的正上方，这个过程被称为寻址(Seeking)，对应消耗的时间被称为**寻址时间**(ST, **Seek** **T**ime)，一般取多次测试的平均寻址时间。

   *当前（2020年）主流技术制造的产品寻址时间为3ms-15ms*

3. 等待读取扇区  --  磁头在目标磁道上方等待目标扇区就位

   找到对应磁道不一定能马上读取数据，需要等待盘片(Platter)旋转到初始数据块所在的扇区(Sector)，磁头落在读写磁头正上方的之后才能开始读取数据，该过程中消耗的时间称为**旋转延时**(RD, **R**otational **D**elay，一般单位为毫秒ms)，最坏的情况就是盘片旋转整整一圈（360度）之后磁头才能读取到数据，所以一般取均值即旋转半圈（0度-360度的均值为180度）的消耗时间：
   $$
   RD = 60 / RPM / 2
   $$
   *RPM即**R**evolution(s) **P**er **M**inute，每分钟转速。*

   例如7200转硬盘理论旋转延时=60/7200/2，约4.1666ms。

4. 读写数据 -- 磁头读写数据

   接着，随着盘片的旋转，磁头不断的读/写相应的数据块，直到完成这次IO所需要操作的全部数据，这个过程称为数据传送(Data Transfer)，该过程的时间称为**传送时间**(Transfer Time)。磁盘参数会提供其最大读写速度，要达到这种速度是很有难度的（目前--2020年可以理解为远远达不到），消耗的时间很短，在用于计算测试指标时可以忽略不计。

一次IO消耗时间=寻址时间+旋转延时+传送时间

于是得出每秒IO次数IOPS计算公式（忽略到耗时极短的数据传送时间）：
$$
IOPS = 1000/ ( RD +  ST )
$$


最常用的量测的指标是“随机存取”及“循环访问”。

|     量测     |                   说明                   |
| :----------: | :--------------------------------------: |
|    总IOPS    | 每秒读写次数的总和（混合读取及写入测试） |
| 随机读取IOPS |          每秒平均的随机读取次数          |
| 随机写入IOPS |          每秒平均的随机写入次数          |
| 循序读取IOPS |          每秒平均的循序读取次数          |
| 循序写入IOPS |          每秒平均的循序写入次数          |

机械硬盘或是其他类似的机电存储设备，其随机存取IOPS主要和存储设备的寻址时间有关；

固态硬盘及其他固态电子设备，其随机存取IOPS主要和存储设备的内部控制器及记亿体接口速度有关。

循序访问的IOPS公式如下：
$$
IOPS * TransferSize = Bytes/Sec
$$
TransferSize即传输大小单位为Byte，计算完毕一般转换为MB之类的单位便于阅读。



