**正则表达式:regular expression**(Regex)，用以匹配和处理文本的字符串，查找和替换特定信息的工具。

[TOC]

# 正则元字符

正则表达式中使用一些具有特殊含义的字符来实现匹配和处理文本的功能，这些字符如`.` `\` `[]` `()` `{}` `+` `*` `?` `^` `$` 等，称为**元字符**（metacharacter）。

元字符的含义和作用取决于它们在正则表达式中的位置。

如果要匹配元字符本身，则需要使用转义符`\`。如要匹配`[ ]`，则需要使用`\[`和`\]`，匹配`\`则需要使用`\\`。


# 匹配单个字符

- 普通字符：直接使用要匹配的字符 
  例：`abc` 匹配字符串 "abc"

- 任意单个字符：`.` 匹配除了换行符以外的任意单个字符  
  例：`a.c` 可匹配 "abc"、"a9c"、"a-c" 等

- 转义字符：使用 `\` 转义1个特殊字符（参看元字符）
  - `\.` 匹配点字符 `.`  
  - `\\` 匹配反斜杠 `\`



# 匹配一组字符

- 字符集合：`[abc]` 匹配 "a"、"b" 或 "c" 中任意一个字符
- 字符区间：`[a-z]` 匹配所有小写字母，`[0-9]` 匹配数字
- 排除集合：`[^abc]` 匹配除 "a"、"b"、"c" 之外的任意单个字符



# 重复匹配

## 基本重复符号

| 符号 | 含义                        |
| ---- | --------------------------- |
| ?    | 重复 0 或 1 次（可选）      |
| *    | 重复 0 次或多次（任意次数） |
| +    | 重复 1 次或多次             |

贪婪与懒惰模式：
`*`、`+` 和 `?` 默认是贪婪模式，尽可能多地匹配字符。
加 `?` 变为懒惰：尽可能少地匹配字符。

例：`a.*b` 是贪婪匹配，`a.*?b` 是懒惰匹配。


## 指定重复次数

| 表达式  | 含义                 |
| ------- | -------------------- |
| `{n}`   | 恰好 n 次            |
| `{n,m}` | 至少 n 次，最多 m 次 |
| `{n,}`  | 至少 n 次，无上限    |


# 位置匹配

## 单词边界

| 表达式 | 描述                   | 
|--------|--------------------- |
| \b     | 匹配单词边界           |
| \B     | 匹配非单词边界位置       |

例：`\bcat\b` 匹配单词 "cat"，但不会匹配 "scattered"；`\Bcat\B` 匹配 "cat" 但不在单词边界上。

## 字符串边界

| 表达式 | 描述                  |
|--------|-----------------------|
| `^`    | 匹配字符串或行的开始     |
| `$`    | 匹配字符串或行的结尾     |

例：`^Hello` 匹配以 "Hello" 开头的字符串，`world$` 匹配以 "world" 结尾的字符串。

在启用多行模式（multiline mode）（`(?m)`）下，正则表达式引擎把行分隔符当作一个字符串分隔符来对待，`^` 和 `$` 会匹配每一行的行首行尾

例：`(?m)^\s*//.*$` 匹配每一行的注释


# 空白元字符

表示空白字符的元字符用于匹配空格、制表符等不可见字符。

| 元字符  | 匹配说明               |
| ---- | --------------------   |
| \b   | 回退符（backspace键盘）   |
| \f   | 换页符（form feed）      |
| \n   | 换行符（new line）       |
| \r   | 回车符（carriage return）|
| \t   | 制表符（tab）            |
| \v   | 垂直制表符（vertical tab）|

`\r\n`是一个回车加换行组合，有的操作系统（如windows）使用它作为文本行的结束标签（结束上段文本并添加一个空白行）。


# 字符集元字符

字符集元字符用于匹配特定类型的字符，如数字、字母、空白等。

| 元字符  | 匹配说明                 | 等价表达式     |
| ---- | ------------------------- | ------------- |
| \d   | 数字（digit）              | [0-9]         |
| \D   | 非数字                     | [^0-9]        |
| \w   | 数字、字母或下划线（word）    | [a-zA-Z0-9_]  |
| \W   | 非字母、数字或下划线          | [^a-zA-Z0-9_] |
| \s   | 空白字符（white space）      | [\f\n\r\t\v]  |
| \S   | 非空白字符                   | [^\f\n\r\t\v] |


# 数值进制

匹配特定数值进制的字符。

| 元字符 | 匹配说明                  |
| ---- | ------------------------- |
| \x   | 十六进制（hexadecimal digit）| 
| \0   | 八进制（Octal digit）        |
| \u   | Unicode字符（Unicode character）|    
| \U   | Unicode字符（Unicode character）|

例：`\x41` 匹配字符 "A"（十六进制 41），`\u4e2d` 匹配中文字符 "中"（Unicode U+4E2D").


# 大小写转换

部分引擎支持

| 元字符 | 说明                             |
| ------ | -------------------------------- |
| \E     | 结束\L或\U转换                   |
| \l     | 把下一个字符转换为小写           |
| \L     | 把\L的\E之间的字符全部转换为小写 |
| \u     | 把下一个字符转换为大写           |
| \U     | 把\U到\E之间的字符全部转换为大写 |


# POSIX字符类

POSIX字符类是正则表达式中用于匹配特定类型字符的预定义字符集。它们通常用于字符类`[ ]`中。

> 严格说，它们是字符类的一种语法扩展，属于正则语法的一部分，不属于传统元字符集合，但常被归入元字符扩展集。

| 字符类         | 匹配说明                            | 等价表达式           |
| ----------- | ------------------------------- | --------------- |
| [:alnum:]   | 字母或数字                           | [a-zA-Z0-9]     |
| [:alpha:]   | 字母                              | [a-zA-Z]        |
| [:lower:]   | 小写字母                            | [a-z]           |
| [:upper:]   | 大写字母                            | [A-Z]           |
| [:digit:]   | 数字                              | [0-9]           |
| [:blank:]   | 空格或制表符                          | [\t ] （t后有一个空格） |
| [:cntrl:]   | ASCII控制字符(ASCII 0到31及ASCII 127) |                 |
| [:graph:] | 同[:print:]                      | [:print:]       |
| [:print:]   | 可打印字符                           |                 |
| [:punct:]   | 既不属于[:alnum:]也不属于[:cntrl:]的字符   |                 |
| [:space:]   | 空白（包括空格）                        | [^\f\n\r\t\v]   |
| [:xdigit:]  | 十六进制数字                          | [a-fA-F0-9]     |



# 子表达式与分组

子表达式把正则表达式中某一部分划为一个独立元素，用于重复、分组、引用等操作。
使用`()` 将子表达式括起来。

例：`(abc)+` 匹配一个或多个 "abc"。



## 回溯引用（Backreference）

回溯引用用于引用之前定义的子表达式。

回溯引用的语法是 `\number`，其中 `number` 是子表达式的序号（从1开始）。如果子表达式是第一个括号，则使用 `\1` 引用它，第二个括号使用 `\2`，以此类推。



# 零宽度前后查找（Lookaround）

匹配的内容仅用于确定正确的匹配位置，匹配本身并不作为匹配结果的一部分返回。
前后查找返回的结果是0字节，因此，又名零宽度（zero-width）匹配操作。

| 操作符     | 说明      |
| ------- | ------- |
| `(?=exp)`  | （正）向前查找 |
| `(?!exp)`  | 负向前查找   |
| `(?<=exp)` | （正）向后查找 |
| `(?<!exp)` | 负向后查找   |

这里的`exp` 代之具体的正则表达式。
负前后查找相等于（正）前后查找取非，将`=`换成`!`。

例：
- 正向前查找：`.+(?=:)` 可提取 URL 协议部分（如 http）
- 正向后查找：`(?<=\$)[0-9.]+` 提取金额（匹配 $ 后的数字）




# 条件匹配（Conditional Pattern）

嵌入一定的条件进行匹配，格式为：`?(condition)yes|no` 

条件匹配的语法是：`(?(condition)yes|no)`，其中 `condition` 可以是一个回溯引用编号，或零宽度断言。

例：HTML中带`<img>`的链接整体匹配 `(<[aA]\s[^>]*>\s*)?<img\s+[^>]+>(?(1)\s*</[aA]>)`
